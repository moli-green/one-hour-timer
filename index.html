<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>1-Hour Challenge Timer</title>
    <style>
        body {
            background-color: transparent; /* OBSで透過させるため */
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }

        #timer {
            font-size: 120px;
            font-weight: 900;
            color: white;
            text-shadow: 4px 4px 10px rgba(0, 0, 0, 0.8); /* 視認性確保 */
            letter-spacing: 4px;
        }

        .warning { color: #ffcc00 !important; } /* 5分前 */
        .danger { color: #ff4444 !important; }  /* 1分前 */
    </style>
</head>
<body>

    <div id="timer">60:00</div>

    <script>
        let timeLeft = 3600; // 1時間 (秒)
        const timerDisplay = document.getElementById('timer');

        // Web Audio API の設定
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playFinishSound() {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(880, audioCtx.currentTime); // A5の音
            
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1);

            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 1);
        }

        const countdown = setInterval(() => {
            let minutes = Math.floor(timeLeft / 60);
            let seconds = timeLeft % 60;

            // 表示の更新
            timerDisplay.textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            // 色の変化
            if (timeLeft <= 60) {
                timerDisplay.className = 'danger';
            } else if (timeLeft <= 300) {
                timerDisplay.className = 'warning';
            }

            if (timeLeft <= 0) {
                clearInterval(countdown);
                timerDisplay.textContent = "FINISH!";
                playFinishSound();
            }

            timeLeft--;
        }, 1000);

        // ブラウザの仕様上、ユーザーが一度画面をクリックしないと音が出ない場合があるため
        window.addEventListener('click', () => {
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        });
    </script>
</body>
</html>